---
title: "Phase II report figures"
author: "Jessica Guo"
date: "2/15/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(BioCro)
library(dplyr)
library(ggplot2)
```

# Show differences between treatment weather conditions

Obtain dates of transplanting for greenhouse and outdoor. 
```{r}
# Retrieve GH and Field sowing and transplant dates
load("~/sentinel-detection/data/cleaned_data/biomass/greenhouse_outdoor_biomass.Rdata")
exp_dates <- greenhouse_outdoor_biomass %>%
  filter(exp_site == "GH"  & exp_number == 1 & treatment == "pot" & 
           is.na(panicle_bag_date) == T|
           exp_site == "Field"  & exp_number == 2 & treatment == "jolly_pot" & 
           is.na(panicle_bag_date) == T) %>%
  group_by(exp_site) %>%
  summarize(sowing = unique(sowing_date),
            transplant = unique(transplant_date),
            harvest = unique(harvest_date)) %>%
  mutate(chamber_dur = difftime(transplant, sowing, units = "days"))
```

Read in greenhouse and outdoor weather conditions
```{r}
gh <- read.csv("../BioCro/DARPA/env_comparison/inputs/weather.gh.2020.csv") %>%
  filter(!(doy %in% 1:7)) %>%
  mutate(dt = as.POSIXct((doy-8)*24*60*60 + hour*60*60, origin = "2020-02-21"),
         trt = "Greenhouse")

out <- read.csv("../BioCro/DARPA/env_comparison/inputs/weather.out.2020.csv") %>%
  filter(!(doy %in% 1:7)) %>%
  mutate(dt = as.POSIXct((doy-8)*24*60*60 + hour*60*60, origin = "2020-08-19"),
         trt = "Outdoor")

# data("weather04")
# ebi <-  weather04 %>%
#   filter(doy > 7 & doy < 80) %>%
#   mutate(dt = as.POSIXct((doy-1)*24*60*60 + hour*60*60, origin = "2004-01-01"),
#          trt = "Urbana, IL")

all_wide <- rbind.data.frame(gh, out) %>%
  relocate(trt, dt)
all_long <- all_wide %>%
  tidyr::pivot_longer(!c(trt, dt, year, doy, hour), names_to = "Variable", values_to = "Value") %>%
  filter(Variable %in% c("precip", "RH", "Temp"))

```

Plot long data in facets by location. 
```{r}
fig_gh <- ggplot(all_long[all_long$trt == "gh",], aes(x = dt, y = Value)) +
  geom_point(alpha = 0.25) +
  theme_bw(base_size = 12) +
  facet_wrap(~Variable, ncol = 1, scales = "free")
print(fig_gh)
```